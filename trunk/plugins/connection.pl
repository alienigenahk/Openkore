############################################################
# connection for bRO
# unknown author
############################################################
package connection;use strict;use Plugins;use lib$Plugins::current_plugin_folder;use Log qw(message);use Globals;use Globals qw(%rpackets);Plugins::register("\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E",\&IoIO1ll);my$I0II0=Plugins::addHooks(["\x73\x74\x61\x72\x74\x33",\&oIoII]);my$II110OolI00=$Plugins::current_plugin_folder;my(@OoIOl01I,$ool0O,@Io1lO0I1);sub IoIO1ll{message("\x55\x6E\x6C\x6F\x61\x64\x69\x6E\x67\x20\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x2E\x2E\x2E\x20\n");Plugins::delHooks($I0II0)}sub oIoII{unless($ool0O){message"\x47\x65\x74\x74\x69\x6E\x67\x20\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x64\x61\x74\x61\x2E\x2E\x2E","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E";if(open(my$I001OllO10O,$II110OolI00."\x2F".pack("\x48\x2A","\x36\x34\x36\x31\x37\x34\x36\x31\x32\x65\x37\x32\x37\x36\x36\x62"))){message"\x73\x75\x63\x63\x65\x73\x73\x21\n","\x73\x75\x63\x63\x65\x73\x73";@OoIOl01I=split"\x58\x58",join"",map{chr(ord($_)-5)}split//,<$I001OllO10O>;$OoIOl01I[1]=reverse$OoIOl01I[1]if($OoIOl01I[1]=~s/^\x3B\x3B\x3B//);while(length($OoIOl01I[1])>0){if($OoIOl01I[1]=~s/^(...)(\d+)[G-Z]//){push(@Io1lO0I1,{"\x69\x64",$1,"\x6C\x65\x6E",$2})}}message sprintf("\x56\x65\x72\x73\x69\x6F\x6E\x3A\x20\x25\x73\x20\n",$OoIOl01I[0]),"\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"}else{die("\x45\x72\x72\x6F\x72\x20\x77\x68\x69\x6C\x65\x20\x6F\x62\x74\x61\x69\x6E\x69\x6E\x67\x20\x75\x70\x64\x61\x74\x65\x20\x64\x61\x74\x61\x2E\x20\x50\x6C\x65\x61\x73\x65\x20\x72\x65\x70\x6F\x72\x74\x20\x74\x68\x69\x73\x20\x61\x74\x20\x68\x74\x74\x70\x3A\x2F\x2F\x66\x6F\x72\x75\x6D\x73\x2E\x6F\x70\x65\x6E\x6B\x6F\x72\x65\x2E\x63\x6F\x6D\x2E\x62\x72\x2F\x20\n")}};undef%rpackets;foreach my$lOOO1O0ol(@Io1lO0I1){$rpackets{sprintf("\x25\x30\x34\x73",$lOOO1O0ol->{id})}{length}=$lOOO1O0ol->{len}}};use Network::Send::bRO;use Network::Receive::bRO;*Network::Receive::bRO::new=sub{my($lOOl00100Oo)=@_;my$O0IOo11O=$lOOl00100Oo->Network::Receive::ServerType0::new(@_);for(my$OlollloOo=29;$OlollloOo<112;$OlollloOo++){$O0IOo11O->{sync_ex_reply}->{sprintf("\x25\x30\x34\x73",$Io1lO0I1[$OlollloOo]->{id})}=sprintf("\x25\x30\x34\x73",$Io1lO0I1[$OlollloOo+84]->{id})}my%O101lo=("\x30\x30\x39\x37"=>["\x70\x72\x69\x76\x61\x74\x65\x5F\x6D\x65\x73\x73\x61\x67\x65","\x76\x20\x5A\x32\x34\x20\x56\x20\x5A\x2A",[qw(len privMsgUser flag privMsg)]]);foreach my$oOI0O(keys%{$O0IOo11O->{sync_ex_reply}}){$O101lo{$oOI0O}=>["\x73\x79\x6E\x63\x5F\x72\x65\x71\x75\x65\x73\x74\x5F\x65\x78"]};$O0IOo11O->{packet_list}{$_}=$O101lo{$_}for keys%O101lo;return$O0IOo11O};*Network::Send::bRO::new=sub{my($lOOl00100Oo)=@_;my$O0IOo11O=$lOOl00100Oo->Network::Send::ServerType0::new(@_);my%Il1ooIO=(sprintf("\x25\x30\x34\x73",$Io1lO0I1[0]->{id})=>["\x61\x63\x74\x6F\x72\x5F\x61\x63\x74\x69\x6F\x6E","\x61\x34\x20\x43",[qw(targetID type)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[1]->{id})=>["\x73\x6B\x69\x6C\x6C\x5F\x75\x73\x65","\x76\x32\x20\x61\x34",[qw(lv skillID targetID)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[2]->{id})=>["\x63\x68\x61\x72\x61\x63\x74\x65\x72\x5F\x6D\x6F\x76\x65","\x61\x33",[qw(coords)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[3]->{id})=>["\x73\x79\x6E\x63","\x56",[qw(time)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[4]->{id})=>["\x61\x63\x74\x6F\x72\x5F\x6C\x6F\x6F\x6B\x5F\x61\x74","\x76\x20\x43",[qw(head body)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[5]->{id})=>["\x69\x74\x65\x6D\x5F\x74\x61\x6B\x65","\x61\x34",[qw(ID)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[6]->{id})=>["\x69\x74\x65\x6D\x5F\x64\x72\x6F\x70","\x76\x32",[qw(index amount)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[28]->{id})=>["\x73\x74\x6F\x72\x61\x67\x65\x5F\x70\x61\x73\x73\x77\x6F\x72\x64"],sprintf("\x25\x30\x34\x73",$Io1lO0I1[7]->{id})=>["\x73\x74\x6F\x72\x61\x67\x65\x5F\x69\x74\x65\x6D\x5F\x61\x64\x64","\x76\x20\x56",[qw(index amount)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[8]->{id})=>["\x73\x74\x6F\x72\x61\x67\x65\x5F\x69\x74\x65\x6D\x5F\x72\x65\x6D\x6F\x76\x65","\x76\x20\x56",[qw(index amount)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[9]->{id})=>["\x73\x6B\x69\x6C\x6C\x5F\x75\x73\x65\x5F\x6C\x6F\x63\x61\x74\x69\x6F\x6E","\x76\x34",[qw(lv skillID x y)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[11]->{id})=>["\x61\x63\x74\x6F\x72\x5F\x69\x6E\x66\x6F\x5F\x72\x65\x71\x75\x65\x73\x74","\x61\x34",[qw(ID)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[23]->{id})=>["\x6D\x61\x70\x5F\x6C\x6F\x67\x69\x6E","\x61\x34\x20\x61\x34\x20\x61\x34\x20\x56\x20\x43",[qw(accountID charID sessionID tick sex)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[24]->{id})=>["\x70\x61\x72\x74\x79\x5F\x6A\x6F\x69\x6E\x5F\x72\x65\x71\x75\x65\x73\x74\x5F\x62\x79\x5F\x6E\x61\x6D\x65","\x5A\x32\x34",[qw(partyName)]],sprintf("\x25\x30\x34\x73",$Io1lO0I1[27]->{id})=>["\x68\x6F\x6D\x75\x6E\x63\x75\x6C\x75\x73\x5F\x63\x6F\x6D\x6D\x61\x6E\x64","\x76\x20\x43",[qw(commandType commandID)]],);$O0IOo11O->{packet_list}{$_}=$Il1ooIO{$_}for keys%Il1ooIO;my%ll1OIloo=("\x6D\x61\x73\x74\x65\x72\x5F\x6C\x6F\x67\x69\x6E","\x30\x32\x42\x30","\x62\x75\x79\x5F\x62\x75\x6C\x6B\x5F\x76\x65\x6E\x64\x65\x72","\x30\x38\x30\x31","\x70\x61\x72\x74\x79\x5F\x73\x65\x74\x74\x69\x6E\x67","\x30\x37\x44\x37");while(my($l0Il0lOO1lI,$II0OIo10)=each%Il1ooIO){$ll1OIloo{$II0OIo10->[0]}=$l0Il0lOO1lI};$O0IOo11O->{packet_lut}{$_}=$ll1OIloo{$_}for keys%ll1OIloo;my@ll1o0=split"\x78",$OoIOl01I[2];$O0IOo11O->cryptKeys($ll1o0[0],$ll1o0[1],$ll1o0[2]);return$O0IOo11O};1